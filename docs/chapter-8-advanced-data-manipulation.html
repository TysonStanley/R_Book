<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 8: Advanced Data Manipulation | R for the Health, Behavioral, and Social Sciences</title>
  <meta name="description" content="This book introduces the R statistical language for researchers in the health, behavioral, educational, and psychological sciences. It is designed for those that have little background in statistical programming but would like to use the powerful statistical and visualization tool that R offers at no cost. The light-hearted design of this book allows a researcher to investigate and begin using R relatively stress-free with intuitive and interesting examples.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 8: Advanced Data Manipulation | R for the Health, Behavioral, and Social Sciences />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="Cover.jpg" />
  <meta property="og:description" content="This book introduces the R statistical language for researchers in the health, behavioral, educational, and psychological sciences. It is designed for those that have little background in statistical programming but would like to use the powerful statistical and visualization tool that R offers at no cost. The light-hearted design of this book allows a researcher to investigate and begin using R relatively stress-free with intuitive and interesting examples." />
  <meta name="github-repo" content="tysonstanley/tysonstanley.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8: Advanced Data Manipulation | R for the Health, Behavioral, and Social Sciences />
  
  <meta name="twitter:description" content="This book introduces the R statistical language for researchers in the health, behavioral, educational, and psychological sciences. It is designed for those that have little background in statistical programming but would like to use the powerful statistical and visualization tool that R offers at no cost. The light-hearted design of this book allows a researcher to investigate and begin using R relatively stress-free with intuitive and interesting examples." />
  <meta name="twitter:image" content="Cover.jpg" />

<meta name="author" content="Tyson S. Barrett">


<meta name="date" content="2019-01-10">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="chapter-7-other-modeling-techniques.html">
<link rel="next" href="chapter-9-advanced-plotting.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#part-i"><i class="fa fa-check"></i>Part I</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#part-ii"><i class="fa fa-check"></i>Part II</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#part-iii"><i class="fa fa-check"></i>Part III</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html"><i class="fa fa-check"></i>Chapter 1: The Basics</a><ul>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#objects"><i class="fa fa-check"></i>Objects</a></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#data-types"><i class="fa fa-check"></i>Data Types</a></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#functions"><i class="fa fa-check"></i>Functions</a><ul>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#operators"><i class="fa fa-check"></i>Operators</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#importing-data"><i class="fa fa-check"></i>Importing Data</a></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#saving-data"><i class="fa fa-check"></i>Saving Data</a></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#apply-it"><i class="fa fa-check"></i>Apply it</a><ul>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#step-1"><i class="fa fa-check"></i>Step 1</a></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#step-2"><i class="fa fa-check"></i>Step 2</a></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#step-3"><i class="fa fa-check"></i>Step 3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#conclusions"><i class="fa fa-check"></i>Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html"><i class="fa fa-check"></i>Chapter 2: Working with and Cleaning Your Data</a><ul>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#tidy-methods"><i class="fa fa-check"></i>Tidy Methods</a></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#tidy-long-form"><i class="fa fa-check"></i>Tidy (Long) Form</a><ul>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#wide-form"><i class="fa fa-check"></i>Wide Form</a></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#long-form"><i class="fa fa-check"></i>Long Form</a></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#data-used-for-examples"><i class="fa fa-check"></i>Data Used for Examples</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#piping"><i class="fa fa-check"></i>Piping</a></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#select-and-filter"><i class="fa fa-check"></i>Select and Filter</a></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#mutate-and-transmute"><i class="fa fa-check"></i>Mutate and Transmute</a></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#grouping-and-summarizing"><i class="fa fa-check"></i>Grouping and Summarizing</a></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#reshaping"><i class="fa fa-check"></i>Reshaping</a></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#joining-merging"><i class="fa fa-check"></i>Joining (merging)</a><ul>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#inner-join"><i class="fa fa-check"></i>Inner Join</a></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#left-or-right-join"><i class="fa fa-check"></i>Left or Right Join</a></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#full-join"><i class="fa fa-check"></i>Full Join</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#wrap-it-up"><i class="fa fa-check"></i>Wrap it up</a></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#general-cleaning-of-the-data-set"><i class="fa fa-check"></i>General Cleaning of the Data Set</a></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#apply-it-1"><i class="fa fa-check"></i>Apply It</a><ul>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#step-1-1"><i class="fa fa-check"></i>Step 1</a></li>
<li class="chapter" data-level="" data-path="chapter-2-working-with-and-cleaning-your-data.html"><a href="chapter-2-working-with-and-cleaning-your-data.html#step-2-1"><i class="fa fa-check"></i>Step 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-3-understanding-and-describing-your-data.html"><a href="chapter-3-understanding-and-describing-your-data.html"><i class="fa fa-check"></i>Chapter 3: Understanding and Describing Your Data</a><ul>
<li class="chapter" data-level="" data-path="chapter-3-understanding-and-describing-your-data.html"><a href="chapter-3-understanding-and-describing-your-data.html#descriptive-statistics"><i class="fa fa-check"></i>Descriptive Statistics</a></li>
<li class="chapter" data-level="" data-path="chapter-3-understanding-and-describing-your-data.html"><a href="chapter-3-understanding-and-describing-your-data.html#visualizations"><i class="fa fa-check"></i>Visualizations</a><ul>
<li><a href="chapter-3-understanding-and-describing-your-data.html#using-ggplot2">Using <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-3-understanding-and-describing-your-data.html"><a href="chapter-3-understanding-and-describing-your-data.html#apply-it-2"><i class="fa fa-check"></i>Apply It</a><ul>
<li class="chapter" data-level="" data-path="chapter-3-understanding-and-describing-your-data.html"><a href="chapter-3-understanding-and-describing-your-data.html#step-1-2"><i class="fa fa-check"></i>Step 1</a></li>
<li class="chapter" data-level="" data-path="chapter-3-understanding-and-describing-your-data.html"><a href="chapter-3-understanding-and-describing-your-data.html#step-2-2"><i class="fa fa-check"></i>Step 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html"><i class="fa fa-check"></i>Chapter 4: Basic Analyses</a><ul>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#anova"><i class="fa fa-check"></i>ANOVA</a></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#assumptions"><i class="fa fa-check"></i>Assumptions</a></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#linear-modeling"><i class="fa fa-check"></i>Linear Modeling</a></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#assumptions-1"><i class="fa fa-check"></i>Assumptions</a></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#comparing-models"><i class="fa fa-check"></i>Comparing Models</a><ul>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#compare-statistically"><i class="fa fa-check"></i>Compare Statistically</a></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#compare-in-a-table"><i class="fa fa-check"></i>Compare in a Table</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#when-assumptions-fail"><i class="fa fa-check"></i>When Assumptions Fail</a><ul>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#log-linear-log-log-linear-log-other"><i class="fa fa-check"></i>Log-Linear, Log-Log, Linear-Log, Other</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#interactions"><i class="fa fa-check"></i>Interactions</a><ul>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#interactions-in-anova"><i class="fa fa-check"></i>Interactions in ANOVA</a></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#interactions-in-linear-regression"><i class="fa fa-check"></i>Interactions in Linear Regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#apply-it-3"><i class="fa fa-check"></i>Apply It</a><ul>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#step-1-3"><i class="fa fa-check"></i>Step 1</a></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#step-2-3"><i class="fa fa-check"></i>Step 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html"><i class="fa fa-check"></i>Chapter 5: Generalized Linear Models</a><ul>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#logistic-regression"><i class="fa fa-check"></i>Logistic Regression</a></li>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#poisson-regression"><i class="fa fa-check"></i>Poisson Regression</a><ul>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#gamma"><i class="fa fa-check"></i>Gamma</a></li>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#two-part-or-hurdle-models"><i class="fa fa-check"></i>Two-Part or Hurdle Models</a></li>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#negative-binomial"><i class="fa fa-check"></i>Negative Binomial</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#beta-regression"><i class="fa fa-check"></i>Beta Regression</a></li>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#apply-it-4"><i class="fa fa-check"></i>Apply It</a><ul>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#step-1-4"><i class="fa fa-check"></i>Step 1</a></li>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#step-2-4"><i class="fa fa-check"></i>Step 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#conclusions-1"><i class="fa fa-check"></i>Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-6-multilevel-modeling.html"><a href="chapter-6-multilevel-modeling.html"><i class="fa fa-check"></i>Chapter 6: Multilevel Modeling</a><ul>
<li class="chapter" data-level="" data-path="chapter-6-multilevel-modeling.html"><a href="chapter-6-multilevel-modeling.html#gee"><i class="fa fa-check"></i>GEE</a></li>
<li class="chapter" data-level="" data-path="chapter-6-multilevel-modeling.html"><a href="chapter-6-multilevel-modeling.html#mixed-effects"><i class="fa fa-check"></i>Mixed Effects</a></li>
<li class="chapter" data-level="" data-path="chapter-6-multilevel-modeling.html"><a href="chapter-6-multilevel-modeling.html#apply-it-5"><i class="fa fa-check"></i>Apply It</a><ul>
<li class="chapter" data-level="" data-path="chapter-6-multilevel-modeling.html"><a href="chapter-6-multilevel-modeling.html#step-1-5"><i class="fa fa-check"></i>Step 1</a></li>
<li class="chapter" data-level="" data-path="chapter-6-multilevel-modeling.html"><a href="chapter-6-multilevel-modeling.html#step-2-5"><i class="fa fa-check"></i>Step 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-6-multilevel-modeling.html"><a href="chapter-6-multilevel-modeling.html#conclusions-2"><i class="fa fa-check"></i>Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html"><i class="fa fa-check"></i>Chapter 7: Other Modeling Techniques</a><ul>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#mediation-modeling"><i class="fa fa-check"></i>Mediation Modeling</a></li>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#structural-equation-modeling"><i class="fa fa-check"></i>Structural Equation Modeling</a></li>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#machine-learning-techniques"><i class="fa fa-check"></i>Machine Learning Techniques</a><ul>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#ridge-lasso-and-elastic-net"><i class="fa fa-check"></i>Ridge, Lasso and Elastic Net</a></li>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#random-forests"><i class="fa fa-check"></i>Random Forests</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#apply-it-6"><i class="fa fa-check"></i>Apply It</a><ul>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#step-1-6"><i class="fa fa-check"></i>Step 1</a></li>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#step-2-6"><i class="fa fa-check"></i>Step 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#conclusions-3"><i class="fa fa-check"></i>Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html"><i class="fa fa-check"></i>Chapter 8: Advanced Data Manipulation</a><ul>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html#reshaping-your-data"><i class="fa fa-check"></i>Reshaping Your Data</a><ul>
<li><a href="chapter-8-advanced-data-manipulation.html#the-reshape-function">The <code>reshape()</code> function</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html#repeating-actions-looping"><i class="fa fa-check"></i>Repeating Actions (Looping)</a><ul>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html#your-own-functions"><i class="fa fa-check"></i>Your Own Functions</a></li>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html#vectorized"><i class="fa fa-check"></i>Vectorized</a></li>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html#for-loops"><i class="fa fa-check"></i>For Loops</a></li>
<li><a href="chapter-8-advanced-data-manipulation.html#the-apply-family">The <code>apply</code> family</a></li>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html#using-anonymous-functions-in-apply"><i class="fa fa-check"></i>Using “Anonymous Functions” in Apply</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html#apply-it-7"><i class="fa fa-check"></i>Apply It</a><ul>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html#step-1-7"><i class="fa fa-check"></i>Step 1</a></li>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html#step-2-7"><i class="fa fa-check"></i>Step 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html#conclusions-4"><i class="fa fa-check"></i>Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html"><i class="fa fa-check"></i>Chapter 9: Advanced Plotting</a><ul>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#types-of-plots"><i class="fa fa-check"></i>Types of Plots</a><ul>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#scatterplots"><i class="fa fa-check"></i>Scatterplots</a></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#boxplots"><i class="fa fa-check"></i>Boxplots</a></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#bar-plots"><i class="fa fa-check"></i>Bar Plots</a></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#line-plots"><i class="fa fa-check"></i>Line Plots</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#color-schemes"><i class="fa fa-check"></i>Color Schemes</a></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#themes"><i class="fa fa-check"></i>Themes</a></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#labels-and-titles"><i class="fa fa-check"></i>Labels and Titles</a></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#facetting"><i class="fa fa-check"></i>Facetting</a></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#apply-it-8"><i class="fa fa-check"></i>Apply It</a><ul>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#step-1-8"><i class="fa fa-check"></i>Step 1</a></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#step-2-8"><i class="fa fa-check"></i>Step 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#conclusions-5"><i class="fa fa-check"></i>Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-10-where-to-go-from-here-and-common-pitfalls.html"><a href="chapter-10-where-to-go-from-here-and-common-pitfalls.html"><i class="fa fa-check"></i>Chapter 10: Where to Go from Here and Common Pitfalls</a><ul>
<li class="chapter" data-level="" data-path="chapter-10-where-to-go-from-here-and-common-pitfalls.html"><a href="chapter-10-where-to-go-from-here-and-common-pitfalls.html#common-pitfalls"><i class="fa fa-check"></i>Common Pitfalls</a></li>
<li class="chapter" data-level="" data-path="chapter-10-where-to-go-from-here-and-common-pitfalls.html"><a href="chapter-10-where-to-go-from-here-and-common-pitfalls.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="chapter-10-where-to-go-from-here-and-common-pitfalls.html"><a href="chapter-10-where-to-go-from-here-and-common-pitfalls.html#goodbye-and-good-luck"><i class="fa fa-check"></i>Goodbye and Good Luck</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for the Health, Behavioral, and Social Sciences</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-8-advanced-data-manipulation" class="section level1 unnumbered">
<h1>Chapter 8: Advanced Data Manipulation</h1>
<blockquote>
<p>“Every new thing creates two new questions and two new opportunities.” — Jeff Bezos</p>
</blockquote>
<p>There’s so much more we can do with data in <code>R</code> than what we’ve presented. Two main topics we need to clarify here are:</p>
<ol style="list-style-type: decimal">
<li>How do you reshape your data from wide to long form or vice versa?</li>
<li>How do can we simplify tasks that we need done many times?</li>
</ol>
<p>We will introduce both ideas to you in this chapter. To discuss the first, we will introduce two functions to help you reshape your data: <code>gather()</code> and <code>spread()</code>. For the second, we need to talk about loops. Looping, for our purposes, refers to the ability to repeat something across many variables or data sets. There’s many ways of doing this but some are better than others. For looping, we’ll talk about:</p>
<ol style="list-style-type: decimal">
<li>vectorized functions,</li>
<li><code>for</code> loops, and</li>
<li>the <code>apply</code> family of functions.</li>
</ol>
<div id="reshaping-your-data" class="section level2 unnumbered">
<h2>Reshaping Your Data</h2>
<p>We introduced you to wide form and long form of your data in Chapter 2. In reality, data can take on nearly infinite forms but for most data in health, behavior, and social science, these two forms are sufficient to know. But the question is, how to change the form of your data?</p>
<p>In the <code>tidyverse</code> functions known as <code>gather</code> and <code>spread</code> can help with this in a simple way. To show you, we will use the fake data we started with in Chapter 2.</p>
<pre><code>##    ID Var_Time1 Var_Time2
## 1   1   -1.7103    0.7659
## 2   2    0.2948    0.1767
## 3   3    0.4224    0.5774
## 4   4   -1.2576    0.1143
## 5   5    0.1349    0.5574
## 6   6   -0.4365    0.9922
## 7   7    1.2259    0.2935
## 8   8    0.2666    0.4844
## 9   9    0.6322    0.2556
## 10 10   -0.6303    0.5537</code></pre>
<p>Notice that this data frame is in wide format (each ID is one row and there are multiple times or measurements per person). To change this to wide format, we’ll use <code>gather()</code>. The first argument is the data.frame, followed by two variable names (names that we go into the new long form), and then the numbers of the columns that are the measures (in this case, <code>Var_Time1</code> and <code>Var_Time2</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
long_form &lt;-<span class="st"> </span><span class="kw">gather</span>(d1, <span class="st">&quot;measures&quot;</span>, <span class="st">&quot;values&quot;</span>, <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>)
long_form</code></pre>
<pre><code>##    ID  measures  values
## 1   1 Var_Time1 -1.7103
## 2   2 Var_Time1  0.2948
## 3   3 Var_Time1  0.4224
## 4   4 Var_Time1 -1.2576
## 5   5 Var_Time1  0.1349
## 6   6 Var_Time1 -0.4365
## 7   7 Var_Time1  1.2259
## 8   8 Var_Time1  0.2666
## 9   9 Var_Time1  0.6322
## 10 10 Var_Time1 -0.6303
## 11  1 Var_Time2  0.7659
## 12  2 Var_Time2  0.1767
## 13  3 Var_Time2  0.5774
## 14  4 Var_Time2  0.1143
## 15  5 Var_Time2  0.5574
## 16  6 Var_Time2  0.9922
## 17  7 Var_Time2  0.2935
## 18  8 Var_Time2  0.4844
## 19  9 Var_Time2  0.2556
## 20 10 Var_Time2  0.5537</code></pre>
<p>As you can see, it took the variable names and put that in our first variable that we called “measures”. The actual values of the variables are now in the variable we called “values”. Finally, notice that each ID now has two rows (one for each measure).</p>
<p>To go in the opposite direction (long to wide) we can use the <code>spread()</code> function. All we do is provide the long formed data frame, the measured variable (<code>measures</code>) and the variable with the values (<code>values</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r">wide_form &lt;-<span class="st"> </span><span class="kw">spread</span>(long_form, measures, values)
wide_form</code></pre>
<pre><code>##    ID Var_Time1 Var_Time2
## 1   1   -1.7103    0.7659
## 2   2    0.2948    0.1767
## 3   3    0.4224    0.5774
## 4   4   -1.2576    0.1143
## 5   5    0.1349    0.5574
## 6   6   -0.4365    0.9922
## 7   7    1.2259    0.2935
## 8   8    0.2666    0.4844
## 9   9    0.6322    0.2556
## 10 10   -0.6303    0.5537</code></pre>
<p>And we are back to the wide form.</p>
<p>These steps can be followed for situations where there are many measures per person, many people per cluster, etc. In most cases, this is the way multilevel data analysis occurs (as we discussed in Chapter 6) and is a nice way to get our data ready for plotting.</p>
<div id="the-reshape-function" class="section level3 unnumbered">
<h3>The <code>reshape()</code> function</h3>
<p>It is also possible to do multiple measures at once when moving from wide to long or long to wide. The following figure shows the basics of the <code>reshape()</code> function that was made for an introductory R class (which can also be found <a href="https://tysonstanley.github.io/assets/images/DataCleaning_Handout.pdf">here</a>).</p>
<p></p>
<p>Note a few important features:</p>
<ol style="list-style-type: decimal">
<li><code>reshape()</code> is used for moving from wide to long and long to wide. Here we just tell it the direction.</li>
<li>To indicate multiple columns, use a list of vectors (e.g., <code>list(c(&quot;x1&quot;, &quot;x2&quot;), c(&quot;z1&quot;, &quot;z2&quot;)))</code>).</li>
<li><code>reshape()</code> can be used before or after subsetting, allowing for only the necessary variables to be included in the reshaping process.</li>
</ol>
</div>
</div>
<div id="repeating-actions-looping" class="section level2 unnumbered">
<h2>Repeating Actions (Looping)</h2>
<p>To fully go into looping, understanding how to write your own functions is needed.</p>
<div id="your-own-functions" class="section level3 unnumbered">
<h3>Your Own Functions</h3>
<p>Let’s create a function that estimates the mean (although it is completely unnecessary since there is already a perfectly good <code>mean()</code> function).</p>
<pre class="sourceCode r"><code class="sourceCode r">mean2 &lt;-<span class="st"> </span><span class="cf">function</span>(x){
  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)
  m &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>n) <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(x)
  <span class="kw">return</span>(m)
}</code></pre>
<p>We create a function using the <code>function()</code> function.<a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a> Within the <code>function()</code> we put an <code>x</code>. This is the argument that the function will ask for. Here, it is a numeric vector that we want to take the mean of. We then provide the meat of the function between the <code>{}</code>. Here, we did a simple mean calculation using the <code>length(x)</code> which gives us the number of observations, and <code>sum()</code> which sums the numbers in <code>x</code>.</p>
<p>Let’s give it a try:</p>
<pre class="sourceCode r"><code class="sourceCode r">v1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)   <span class="co">## vector to try</span>
<span class="kw">mean2</span>(v1)                      <span class="co">## our function</span></code></pre>
<pre><code>## [1] 1.8</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(v1)                       <span class="co">## the base R function</span></code></pre>
<pre><code>## [1] 1.8</code></pre>
<p>Looks good! These functions that you create can do whatever you need them to (within the bounds that <code>R</code> can do). I recommend by starting outside of a function that then put it into a function. For example, we would start with:</p>
<pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="kw">length</span>(v1)
m &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>n) <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(v1)
m</code></pre>
<pre><code>## [1] 1.8</code></pre>
<p>and once things look good, we would put it into a function like we had before with <code>mean2</code>. It is an easy way to develop a good function and test it while developing it.</p>
<p>By creating your own function, you can simplify your workflow and can use them in loops, the <code>apply</code> functions and the <code>purrr</code> package.</p>
<p>For practice, we will write one more function. Let’s make a function that takes a vector and gives us the N, the mean, and the standard deviation.</p>
<pre class="sourceCode r"><code class="sourceCode r">important_statistics &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">na.rm=</span><span class="ot">FALSE</span>){
  N  &lt;-<span class="st"> </span><span class="kw">length</span>(x)
  M  &lt;-<span class="st"> </span><span class="kw">mean</span>(x, <span class="dt">na.rm=</span>na.rm)
  SD &lt;-<span class="st"> </span><span class="kw">sd</span>(x, <span class="dt">na.rm=</span>na.rm)
  
  final &lt;-<span class="st"> </span><span class="kw">c</span>(N, M, SD)
  <span class="kw">return</span>(final)
}</code></pre>
<p>One of the first things you should note is that we included a second argument in the function seen as <code>na.rm=FALSE</code> (you can have as many arguments as you want within reason). This argument has a default that we provide as <code>FALSE</code> as it is in most functions that use the <code>na.rm</code> argument. We take what is provided in the <code>na.rm</code> and give that to both the <code>mean()</code> and <code>sd()</code> functions. Finally, you should notice that we took several pieces of information and combined them into the <code>final</code> object and returned that.</p>
<p>Let’s try it out with the vector we created earlier.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">important_statistics</span>(v1)</code></pre>
<pre><code>## [1] 10.000  1.800  1.033</code></pre>
<p>Looks good but we may want to change a few aesthetics. In the following code, we adjust it so we have each one labeled.</p>
<pre class="sourceCode r"><code class="sourceCode r">important_statistics2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">na.rm=</span><span class="ot">FALSE</span>){
  N  &lt;-<span class="st"> </span><span class="kw">length</span>(x)
  M  &lt;-<span class="st"> </span><span class="kw">mean</span>(x, <span class="dt">na.rm=</span>na.rm)
  SD &lt;-<span class="st"> </span><span class="kw">sd</span>(x, <span class="dt">na.rm=</span>na.rm)
  
  final &lt;-<span class="st"> </span><span class="kw">data.frame</span>(N, <span class="st">&quot;Mean&quot;</span>=M, <span class="st">&quot;SD&quot;</span>=SD)
  <span class="kw">return</span>(final)
}
<span class="kw">important_statistics2</span>(v1)</code></pre>
<pre><code>##    N Mean    SD
## 1 10  1.8 1.033</code></pre>
<p>We will come back to this function and use it in some loops and see what else we can do with it.</p>
</div>
<div id="vectorized" class="section level3 unnumbered">
<h3>Vectorized</h3>
<p>By construction, <code>R</code> is the fastest when we use the vectorized form of doing things. For example, when we want to add two variables together, we can use the <code>+</code> operator. Like most functions in <code>R</code>, it is vectorized and so it is fast. Below we create a new vector using the <code>rnorm()</code> function that produces normally distributed random variables. First argument in the function is the length of the vector, followed by the mean and SD.</p>
<pre class="sourceCode r"><code class="sourceCode r">v2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dt">mean=</span><span class="dv">5</span>, <span class="dt">sd=</span><span class="dv">2</span>)
add1 &lt;-<span class="st"> </span>v1 <span class="op">+</span><span class="st"> </span>v2
<span class="kw">round</span>(add1, <span class="dv">3</span>)</code></pre>
<pre><code>##  [1] 7.210 6.424 6.508 5.806 8.469 4.039 5.448 4.090 8.912 7.426</code></pre>
<p>We will compare the speed of this to other ways of adding two variables together and see it is the simplest and quickest.</p>
</div>
<div id="for-loops" class="section level3 unnumbered">
<h3>For Loops</h3>
<p>For loops have a bad reputation in the <code>R</code> world. This is because, in general, they are slow. It is among the slowest of ways to iterate (i.e., repeat) functions. We start here to show you, in essence, what the <code>apply</code> family of functions are doing, often, in a faster way.</p>
<p>At times, it is easiest to develop a for loop and then take it and use it within the <code>apply</code> or <code>purrr</code> functions. It can help you think through the pieces that need to be done in order to get your desired result.</p>
<p>For demonstration, we are using the <code>for</code> loop to add two variables together. The code between the <code>()</code>’s tells <code>R</code> information about how many loops it should do. Here, we are looping through <code>1:10</code> since there are ten observations in each vector. We could also specify this as <code>1:length(v1)</code>. When using <code>for</code> loops, we need to keep in mind that we need to initialize a variable in order to use it within the loop. That’s precisely what we do with the <code>add2</code>, making it a numberic vector with 10 observations.</p>
<pre class="sourceCode r"><code class="sourceCode r">add2 &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="dv">10</span>)   <span class="co">## Initialize</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>){
  add2[i] &lt;-<span class="st"> </span>v1[i] <span class="op">+</span><span class="st"> </span>v2[i]
}
<span class="kw">round</span>(add2, <span class="dv">3</span>)</code></pre>
<pre><code>##  [1] 7.210 6.424 6.508 5.806 8.469 4.039 5.448 4.090 8.912 7.426</code></pre>
<p>Same results! But, we’ll see later that the speed is much than the vectorized function.</p>
</div>
<div id="the-apply-family" class="section level3 unnumbered">
<h3>The <code>apply</code> family</h3>
<p>The <code>apply</code> family of functions that we’ll introduce are:</p>
<ol style="list-style-type: decimal">
<li><code>apply()</code></li>
<li><code>lapply()</code></li>
<li><code>sapply()</code></li>
<li><code>tapply()</code></li>
</ol>
<p>Each essentially do a loop over the data you provide using a function (either one you created or another). The different versions are extremely similar with some minor differences. For <code>apply()</code> you tell it if you want to iterative over the columns or rows; <code>lapply()</code> assumes you want to iterate over the columns and outputs a list (hence the <code>l</code>); <code>sapply()</code> is similar to <code>lapply()</code> but outputs vectors and data frames. <code>tapply()</code> has the most differences because it can iterative over columns by a grouping variable. We’ll show <code>apply()</code>, <code>lapply()</code> and <code>tapply()</code> below.</p>
<p>For example, we can add two variables together here. We provide it the <code>data.frame</code> that has the variables we want to add together.</p>
<pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(v1, v2)
add3 &lt;-<span class="st"> </span><span class="kw">apply</span>(df, <span class="dv">1</span>, sum)
<span class="kw">round</span>(add3, <span class="dv">3</span>)</code></pre>
<pre><code>##  [1] 7.210 6.424 6.508 5.806 8.469 4.039 5.448 4.090 8.912 7.426</code></pre>
<p>The function <code>apply()</code> has three main arguments: a) the <code>data.frame</code> or list of data, b) 1 meaning to apply the function for each row or 2 to the columns, and c) the function to use.</p>
<p>We can also use one of our own functions such as <code>important_statistics2()</code> within the <code>apply</code> family.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lapply</span>(df, important_statistics2)</code></pre>
<pre><code>## $v1
##    N Mean    SD
## 1 10  1.8 1.033
## 
## $v2
##    N  Mean    SD
## 1 10 4.633 1.989</code></pre>
<p>This gives us a list of two elements, one for each variable, with the statistics that our function provides. With a little adjustment, we can make this into a <code>data.frame</code> using the <code>do.call()</code> function with <code>&quot;rbind&quot;</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, <span class="kw">lapply</span>(df, important_statistics2))</code></pre>
<pre><code>##     N  Mean    SD
## v1 10 1.800 1.033
## v2 10 4.633 1.989</code></pre>
<p><code>tapply()</code> allows us to get information by a grouping factor. We are going to add a factor variable to the data frame we are using <code>df</code> and then get the mean of the variables by group.</p>
<pre class="sourceCode r"><code class="sourceCode r">group1 &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">10</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>))
<span class="kw">tapply</span>(df<span class="op">$</span>v1, group1, mean)</code></pre>
<pre><code>##   0   1 
## 1.6 2.0</code></pre>
<p>We now have the means by each group. This, however, is probably replaced by the 3 step summary that we learned earlier in <code>dplyr</code> using <code>group_by()</code> and <code>summarize()</code>.</p>
<p>These functions are useful in many situations, especially where there are no vectorized functions. You can always get an idea of whether to use a <code>for</code> loop or an <code>apply</code> function by giving it a try on a small subset of data to see if one is better and/or faster.</p>
<div id="speed-comparison" class="section level4 unnumbered">
<h4>Speed Comparison</h4>
<p>We can test to see how fast functions are with the <code>microbenchmark</code> package. Since it wants functions, we will create a function that uses the <code>for</code> looop.</p>
<pre class="sourceCode r"><code class="sourceCode r">forloop &lt;-<span class="st"> </span><span class="cf">function</span>(var1, var2){
  add2 &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="kw">length</span>(var1))
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>){
    add2[i] &lt;-<span class="st"> </span>var1[i] <span class="op">+</span><span class="st"> </span>var2[i]
  }
  <span class="kw">return</span>(add2)
}</code></pre>
<p>Below, we can see that the vectorized version is nearly 50 times faster than the <code>for</code> loop and 300 times faster than the <code>apply</code>. Although the <code>for</code> loop was faster here, sometimes it can be slower than the <code>apply</code> functions–it just depends on the situation. But, the vectorized functions will almost always be <em>much</em> faster than anything else. It’s important to note that the <code>+</code> is also a function that can be used as we do below, highlighting the fact that anything that does something to an object in <code>R</code> is a function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(microbenchmark)
<span class="kw">microbenchmark</span>(<span class="kw">forloop</span>(v1, v2),
               <span class="kw">apply</span>(df, <span class="dv">1</span>, sum),
               <span class="st">`</span><span class="dt">+</span><span class="st">`</span>(v1, v2))</code></pre>
<pre><code>## Unit: nanoseconds
##               expr   min    lq    mean median    uq     max neval cld
##    forloop(v1, v2)  1464  1580 36829.0   1940  2112 3496929   100   a
##  apply(df, 1, sum) 53981 54781 56289.4  55300 56020  111279   100   a
##            v1 + v2   136   213   305.3    284   389    1381   100   a</code></pre>
<p>Of course, as it says the units are in nanoseconds. Whether a function takes 200 or 200,000 nanoseconds probably won’t change your life. However, if the function is being used repeatedly or on on large data sets, this can make a difference.</p>
</div>
</div>
<div id="using-anonymous-functions-in-apply" class="section level3 unnumbered">
<h3>Using “Anonymous Functions” in Apply</h3>
<p>Last thing to know here is that you don’t need to create a named function everytime you want to use <code>apply</code>. We can use what is called “Anonymous” functions. Below, we use one to get at the N and mean of the data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lapply</span>(df, <span class="cf">function</span>(x) <span class="kw">rbind</span>(<span class="kw">length</span>(x), <span class="kw">mean</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)))</code></pre>
<pre><code>## $v1
##      [,1]
## [1,] 10.0
## [2,]  1.8
## 
## $v2
##        [,1]
## [1,] 10.000
## [2,]  4.633</code></pre>
<p>So we don’t name the function but we design it like we would a named function, just minus the <code>return()</code>. We take <code>x</code> (which is a column of <code>df</code>) and do <code>length()</code> and <code>mean()</code> and bind them by rows. The first argument in the anonymous function will be the column or variable of the data you provide.</p>
<p>Here’s another example:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lapply</span>(df, <span class="cf">function</span>(y) y <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(y))</code></pre>
<pre><code>## $v1
##  [1] 1.936 5.809 3.873 7.746 3.873 1.936 3.873 1.936 1.936 1.936
## 
## $v2
##  [1] 6.243 3.442 4.532 1.816 6.503 3.055 3.467 3.106 7.955 6.460</code></pre>
<p>We take <code>y</code> (again, the column of <code>df</code>), times it by two and divide by the standard deviation of <code>y</code>. Note that this is gibberish and is not some special formula, but again, we can see how flexible it is.</p>
<p>The last two examples also show something important regarding the output:</p>
<ol style="list-style-type: decimal">
<li>The output will be at the level of the anonymous function. The first had two numbers per variable because the function produced two summary statistics for each variable. The second we multiplied <code>y</code> by 2 (so it is still at the individual observation level) and then divide by the SD. This keeps it at the observation level so we get ten values for every variable.</li>
<li>We can name the argument anything we want (as long as it is one word). We used <code>x</code> in the first and <code>y</code> in the second but as long as it is the same within the function, it doesn’t matter what you use.</li>
</ol>
</div>
</div>
<div id="apply-it-7" class="section level2 unnumbered">
<h2>Apply It</h2>
<p><a href="http://tysonbarrett.com/DataR/Chapter8.zip">This link</a> contains a folder complete with an Rstudio project file, an RMarkdown file, and a few data files. Download it and unzip it to do the following steps.</p>
<div id="step-1-7" class="section level3 unnumbered">
<h3>Step 1</h3>
<p>Open the <code>Chapter8.Rproj</code> file. This will open up RStudio for you.</p>
</div>
<div id="step-2-7" class="section level3 unnumbered">
<h3>Step 2</h3>
<p>Once RStudio has started, in the panel on the lower-right, there is a <code>Files</code> tab. Click on that to see the project folder. You should see the data files and the <code>Chapter8.Rmd</code> file. Click on the <code>Chapter8.Rmd</code> file to open it. In this file, import the data, reshape it to long form, create your own function to do something for you, and apply the function in a loop over some of the variables of the data set.</p>
<p>Once that code is in the file, click the <code>knit</code> button. This will create an HTML file with the code and output knitted together into one nice document. This can be read into any browser and can be used to show your work in a clean document.</p>
</div>
</div>
<div id="conclusions-4" class="section level2 unnumbered">
<h2>Conclusions</h2>
<p>These are useful tools to use in your own data manipulation beyond that what we discussed with <code>dplyr</code>. It takes time to get used to making your own functions so be patient with yourself as you learn how to get <code>R</code> to do exactly what you want in a condensed, replicable format.</p>
<p>With these new tricks up your sleeve, we can move on to more advanced plotting using <code>ggplot2</code>.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="22">
<li id="fn22"><p>That seemed like excessive use of the word function… It is important though. So, get used to it!<a href="chapter-8-advanced-data-manipulation.html#fnref22" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-7-other-modeling-techniques.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-9-advanced-plotting.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
