<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Rstats for Researchers</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Rstats for Researchers">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="Rstats for Researchers" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Rstats for Researchers" />
  
  
  

<meta name="author" content="Tyson S. Barrett">


<meta name="date" content="2017-01-03">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="chapter-1-the-basics.html">
<link rel="next" href="chapter-3-understanding-and-describing-your-data.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#part-i"><i class="fa fa-check"></i>Part I</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#part-ii"><i class="fa fa-check"></i>Part II</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#part-iii"><i class="fa fa-check"></i>Part III</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#download-r-and-rstudio"><i class="fa fa-check"></i>Download R and RStudio</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html"><i class="fa fa-check"></i>Chapter 1: The Basics</a><ul>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#objects-data-types-and-functions"><i class="fa fa-check"></i>Objects, Data Types and Functions</a><ul>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#objects"><i class="fa fa-check"></i>Objects</a></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#data-types"><i class="fa fa-check"></i>Data Types</a></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#functions"><i class="fa fa-check"></i>Functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#importing-data"><i class="fa fa-check"></i>Importing Data</a><ul>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#delimited-files"><i class="fa fa-check"></i>Delimited Files</a></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#other-data-formats"><i class="fa fa-check"></i>Other Data Formats</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#saving-data"><i class="fa fa-check"></i>Saving Data</a></li>
<li class="chapter" data-level="" data-path="chapter-1-the-basics.html"><a href="chapter-1-the-basics.html#conclusions"><i class="fa fa-check"></i>Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-2-manipulating-your-data.html"><a href="chapter-2-manipulating-your-data.html"><i class="fa fa-check"></i>Chapter 2: Manipulating Your Data</a><ul>
<li class="chapter" data-level="" data-path="chapter-2-manipulating-your-data.html"><a href="chapter-2-manipulating-your-data.html#tidy-methods"><i class="fa fa-check"></i>Tidy Methods</a></li>
<li class="chapter" data-level="" data-path="chapter-2-manipulating-your-data.html"><a href="chapter-2-manipulating-your-data.html#piping"><i class="fa fa-check"></i>Piping</a></li>
<li class="chapter" data-level="" data-path="chapter-2-manipulating-your-data.html"><a href="chapter-2-manipulating-your-data.html#select-and-filter"><i class="fa fa-check"></i>Select and Filter</a></li>
<li class="chapter" data-level="" data-path="chapter-2-manipulating-your-data.html"><a href="chapter-2-manipulating-your-data.html#grouping-and-summarizing"><i class="fa fa-check"></i>Grouping and Summarizing</a></li>
<li class="chapter" data-level="" data-path="chapter-2-manipulating-your-data.html"><a href="chapter-2-manipulating-your-data.html#reshaping"><i class="fa fa-check"></i>Reshaping</a><ul>
<li class="chapter" data-level="" data-path="chapter-2-manipulating-your-data.html"><a href="chapter-2-manipulating-your-data.html#wide-form"><i class="fa fa-check"></i>Wide Form</a></li>
<li class="chapter" data-level="" data-path="chapter-2-manipulating-your-data.html"><a href="chapter-2-manipulating-your-data.html#long-form"><i class="fa fa-check"></i>Long Form</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-2-manipulating-your-data.html"><a href="chapter-2-manipulating-your-data.html#joining-merging"><i class="fa fa-check"></i>Joining (merging)</a><ul>
<li class="chapter" data-level="" data-path="chapter-2-manipulating-your-data.html"><a href="chapter-2-manipulating-your-data.html#inner-join"><i class="fa fa-check"></i>Inner Join</a></li>
<li class="chapter" data-level="" data-path="chapter-2-manipulating-your-data.html"><a href="chapter-2-manipulating-your-data.html#left-or-right-join"><i class="fa fa-check"></i>Left or Right Join</a></li>
<li class="chapter" data-level="" data-path="chapter-2-manipulating-your-data.html"><a href="chapter-2-manipulating-your-data.html#full-join"><i class="fa fa-check"></i>Full Join</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-3-understanding-and-describing-your-data.html"><a href="chapter-3-understanding-and-describing-your-data.html"><i class="fa fa-check"></i>Chapter 3: Understanding and Describing Your Data</a><ul>
<li class="chapter" data-level="" data-path="chapter-3-understanding-and-describing-your-data.html"><a href="chapter-3-understanding-and-describing-your-data.html#descriptive-statistics"><i class="fa fa-check"></i>Descriptive Statistics</a></li>
<li class="chapter" data-level="" data-path="chapter-3-understanding-and-describing-your-data.html"><a href="chapter-3-understanding-and-describing-your-data.html#visualizations"><i class="fa fa-check"></i>Visualizations</a><ul>
<li class="chapter" data-level="0.0.1" data-path="chapter-3-understanding-and-describing-your-data.html"><a href="chapter-3-understanding-and-describing-your-data.html#ggplot2"><i class="fa fa-check"></i><b>0.0.1</b> <code class="unnumbered">ggplot2</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html"><i class="fa fa-check"></i>Chapter 4: Basic Analyses</a><ul>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#anova"><i class="fa fa-check"></i>ANOVA</a><ul>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#assumptions"><i class="fa fa-check"></i>Assumptions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#linear-modeling"><i class="fa fa-check"></i>Linear Modeling</a><ul>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#assumptions-1"><i class="fa fa-check"></i>Assumptions</a></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#comparing-models"><i class="fa fa-check"></i>Comparing Models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#when-assumptions-fail"><i class="fa fa-check"></i>When Assumptions Fail</a><ul>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#log-linear-log-log-linear-log-other"><i class="fa fa-check"></i>Log-Linear, Log-Log, Linear-Log, Other</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#interactions"><i class="fa fa-check"></i>Interactions</a><ul>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#interactions-in-anova"><i class="fa fa-check"></i>Interactions in ANOVA</a></li>
<li class="chapter" data-level="" data-path="chapter-4-basic-analyses.html"><a href="chapter-4-basic-analyses.html#interactions-in-linear-regression"><i class="fa fa-check"></i>Interactions in Linear Regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html"><i class="fa fa-check"></i>Chapter 5: Generalized Linear Models</a><ul>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#logistic-regression"><i class="fa fa-check"></i>Logistic Regression</a></li>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#poisson-regression"><i class="fa fa-check"></i>Poisson Regression</a><ul>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#gamma"><i class="fa fa-check"></i>Gamma</a></li>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#two-part-or-hurdle-models"><i class="fa fa-check"></i>Two-Part or Hurdle Models</a></li>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#negative-binomial"><i class="fa fa-check"></i>Negative Binomial</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-5-generalized-linear-models.html"><a href="chapter-5-generalized-linear-models.html#beta-regression"><i class="fa fa-check"></i>Beta Regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-6-multilevel-modeling.html"><a href="chapter-6-multilevel-modeling.html"><i class="fa fa-check"></i>Chapter 6: Multilevel Modeling</a><ul>
<li class="chapter" data-level="" data-path="chapter-6-multilevel-modeling.html"><a href="chapter-6-multilevel-modeling.html#gee"><i class="fa fa-check"></i>GEE</a></li>
<li class="chapter" data-level="" data-path="chapter-6-multilevel-modeling.html"><a href="chapter-6-multilevel-modeling.html#mixed-effects"><i class="fa fa-check"></i>Mixed Effects</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html"><i class="fa fa-check"></i>Chapter 7: Other Modeling Techniques</a><ul>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#mediation-modeling"><i class="fa fa-check"></i>Mediation Modeling</a></li>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#structural-equation-modeling"><i class="fa fa-check"></i>Structural Equation Modeling</a></li>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#machine-learning-techniques"><i class="fa fa-check"></i>Machine Learning Techniques</a><ul>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#ridge-lasso-and-elastic-net"><i class="fa fa-check"></i>Ridge, Lasso and Elastic Net</a></li>
<li class="chapter" data-level="" data-path="chapter-7-other-modeling-techniques.html"><a href="chapter-7-other-modeling-techniques.html#random-forests"><i class="fa fa-check"></i>Random Forests</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html"><i class="fa fa-check"></i>Chapter 8: Advanced Data Manipulation</a><ul>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html#your-own-functions"><i class="fa fa-check"></i>Your Own Functions</a></li>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html#vectorized"><i class="fa fa-check"></i>Vectorized</a></li>
<li class="chapter" data-level="" data-path="chapter-8-advanced-data-manipulation.html"><a href="chapter-8-advanced-data-manipulation.html#for-loops"><i class="fa fa-check"></i>For Loops</a></li>
<li><a href="chapter-8-advanced-data-manipulation.html#the-apply-family">The <code>apply</code> family</a></li>
<li><a href="chapter-8-advanced-data-manipulation.html#the-purrr-package">The <code>purrr</code> package</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html"><i class="fa fa-check"></i>Chapter 9: Advanced Plotting</a><ul>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#types-of-plots"><i class="fa fa-check"></i>Types of Plots</a></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#color-schemes"><i class="fa fa-check"></i>Color Schemes</a></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#themes"><i class="fa fa-check"></i>Themes</a></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#labels-and-titles"><i class="fa fa-check"></i>Labels and Titles</a></li>
<li class="chapter" data-level="" data-path="chapter-9-advanced-plotting.html"><a href="chapter-9-advanced-plotting.html#facetting"><i class="fa fa-check"></i>Facetting</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter-10-where-to-go-from-here.html"><a href="chapter-10-where-to-go-from-here.html"><i class="fa fa-check"></i>Chapter 10: Where to go from here</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Rstats for Researchers</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-2-manipulating-your-data" class="section level1 unnumbered">
<h1>Chapter 2: Manipulating Your Data</h1>
<p>In order to manipulate your data in the cleanest, most up-to-date manner, we are going to be using the “tidyverse” group of methods. The tidyverse<a href="#fn8" class="footnoteRef" id="fnref8"><sup>8</sup></a> is a group of packages<a href="#fn9" class="footnoteRef" id="fnref9"><sup>9</sup></a> that provide a simple syntax that can do many basic (and complex) data manipulating. The group of packages can be downloaded via:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
<p>After downloading it, simply use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)</code></pre></div>
<p>Note that when we loaded tidyverse it loaded 6 packages and told you of “conflicts”. These conflicts are where two or more loaded packages have the same function in them. The last loaded package is the one that <code>R</code> will use by default. For example, if we loaded two packages–<code>awesome</code> and <code>amazing</code>–and both had the function–<code>make_really_great</code> and we loaded <code>awesome</code> and then <code>amazing</code> as so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(awesome)
<span class="kw">library</span>(amazing)</code></pre></div>
<p><code>R</code> will automatically use the function from <code>amazing</code>. We can still access the <code>awesome</code> version of the function (because even though the name is the same, they won’t necessarily do the same things for you). We can do this by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">awesome::<span class="kw">make_really_great</span>(arg)</code></pre></div>
<p>That’s a bit of an aside, but know that you can always get at a function even if it is “masked” from your current session.</p>
<div id="tidy-methods" class="section level2 unnumbered">
<h2>Tidy Methods</h2>
<p>I’m introducing this to you for a couple reasons.</p>
<ol style="list-style-type: decimal">
<li>It simplifies the code and makes the code more readable. As the saying goes, there are always at least two collaborators on any project: you and future you.</li>
<li>It is the cutting edge. The most influential individuals in the <code>R</code> world, including the makers and maintainers of <code>RStudio</code>, use these methods and syntax.</li>
</ol>
<p>The majority of what you’ll need to do with data as a researcher will be covered by these functions.</p>
<p>The goal of these functions is to help tidy up your data. Tidy data is based on columns being variables and rows being observations. It is the form that data needs to be in to analyze it, whether that analysis is by graphing, modeling, or other means.</p>
<p>There are several methods that help create tidy data:</p>
<ol style="list-style-type: decimal">
<li>Piping</li>
<li>Selecting and Filtering</li>
<li>Grouping and Summarizing</li>
<li>Reshaping</li>
<li>Joining (merging)</li>
</ol>
<p>To help illustrate each aspect, we are going to use real data from the National Health and Nutrition Examiniation Survey (NHANES). I’ve provided this data at <a href="https://tysonstanley.github.io/assets/Data/NHANES.zip" class="uri">https://tysonstanley.github.io/assets/Data/NHANES.zip</a>. I’ve cleaned it up somewhat already.</p>
<p>Let’s quickly read that data in so we can use it throughout the remainder of this chapter. First, we will set our working directory with <code>setwd</code>. This tells <code>R</code> where to look for files, including your data files. My specific file location is below so you will need to adjust it to wherever you saved the NHANES data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setwd</span>(<span class="st">&quot;~/Dropbox/GitHub/blog_rstats/assets/Data/&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(foreign)
dem_df &lt;-<span class="st"> </span><span class="kw">read.xport</span>(<span class="st">&quot;NHANES_demographics_11.xpt&quot;</span>)
med_df &lt;-<span class="st"> </span><span class="kw">read.xport</span>(<span class="st">&quot;NHANES_MedHeath_11.xpt&quot;</span>)
men_df &lt;-<span class="st"> </span><span class="kw">read.xport</span>(<span class="st">&quot;NHANES_MentHealth_11.xpt&quot;</span>)
act_df &lt;-<span class="st"> </span><span class="kw">read.xport</span>(<span class="st">&quot;NHANES_PhysActivity_11.xpt&quot;</span>)</code></pre></div>
<p>Now we have four separate, but related, data sets in memory:</p>
<ol style="list-style-type: decimal">
<li><code>dem_df</code> containing demographic information</li>
<li><code>med_df</code> containing medical health information</li>
<li><code>men_df</code> containing mental health information</li>
<li><code>act_df</code> containing activity level information</li>
</ol>
<p>Since all of them have all-cap variable names, we are going to quickly change this with a little trick:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(dem_df) &lt;-<span class="st"> </span><span class="kw">tolower</span>(<span class="kw">names</span>(dem_df))
<span class="kw">names</span>(med_df) &lt;-<span class="st"> </span><span class="kw">tolower</span>(<span class="kw">names</span>(med_df))
<span class="kw">names</span>(men_df) &lt;-<span class="st"> </span><span class="kw">tolower</span>(<span class="kw">names</span>(men_df))
<span class="kw">names</span>(act_df) &lt;-<span class="st"> </span><span class="kw">tolower</span>(<span class="kw">names</span>(act_df))</code></pre></div>
<p>This takes the names of the data frame (on the right hand side), changes them to lower case and then reassigns them to the names of the data frame.<a href="#fn10" class="footnoteRef" id="fnref10"><sup>10</sup></a></p>
<p>We will now go through each aspect of the tidy way of working with data using these four data sets.</p>
</div>
<div id="piping" class="section level2 unnumbered">
<h2>Piping</h2>
<p>Let’s introduce a few major themes in this tidyverse. First, the pipe operator – <code>%&gt;%</code>. It helps simplify the code and makes things more readable. It takes what is on the left hand side and puts it in the right hand side’s function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dem_df %&gt;%<span class="st"> </span>summary</code></pre></div>
<p>So the above code takes the data frame <code>df</code> and puts it into the <code>summary</code> function. This does the same thing as <code>summary(df)</code>. In this simple case, it doesn’t really make the code more readable, but in more complex situations it can really help. In the following sections you will see how and where this type of coding is helpful.</p>
</div>
<div id="select-and-filter" class="section level2 unnumbered">
<h2>Select and Filter</h2>
<p>We often want to subset our data in some way before we do many of our analyses. This can make our cognitive load of the data much lighter but it can also be very important in the actual analyses. The code below show the two main ways to subset your data: 1) selecting variables and 2) filtering observations.</p>
<p>To select three variables (i.e. gender [“riagendr”], age [“ridageyr”], and ethnicity [“ridreth1”]) we:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">selected_dem &lt;-<span class="st"> </span>dem_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(riagendr, ridageyr, ridreth1)</code></pre></div>
<p>Now, <code>selected_dem</code> has three variables and all the observations.</p>
<p>We can also filter (i.e. take out observations we don’t want):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filtered_dem &lt;-<span class="st"> </span>dem_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(riagendr ==<span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<p>Since when <code>riagendr == 1</code> the individual is male, <code>filtered_dem</code> only has male participants. We can add multiple filtering options as well:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filtered_dem &lt;-<span class="st"> </span>dem_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(riagendr ==<span class="st"> </span><span class="dv">1</span> &amp;<span class="st"> </span>ridageyr &gt;<span class="st"> </span><span class="dv">16</span>)</code></pre></div>
<p>We now have only males that are older than 16 years old. We used <code>&amp;</code> to say we want <strong>both</strong> conditions to be met. Alternatively, we could:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filtered_dem &lt;-<span class="st"> </span>dem_df %&gt;%
<span class="st">  </span><span class="kw">filter</span>(riagendr ==<span class="st"> </span><span class="dv">1</span> |<span class="st"> </span>ridageyr &gt;<span class="st"> </span><span class="dv">16</span>)</code></pre></div>
<p>which, using <code>|</code> we are saying we want males <strong>or</strong> individuals older than 16. In other words, if either are met, that observation will be kept.</p>
<p>Finally, we can do all of these in one step:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filtered_dem &lt;-<span class="st"> </span>dem_df %&gt;%
<span class="st">  </span><span class="kw">select</span>(riagendr, ridageyr, ridreth1) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(riagendr ==<span class="st"> </span><span class="dv">1</span> &amp;<span class="st"> </span>ridageyr &gt;<span class="st"> </span><span class="dv">16</span>)</code></pre></div>
<p>where we use two <code>%&gt;%</code> operators to grab <code>dem_df</code>, select the three variables, and then filter the rows that we want.</p>
</div>
<div id="grouping-and-summarizing" class="section level2 unnumbered">
<h2>Grouping and Summarizing</h2>
<p>A major aspect of analysis is comparing groups. Lucky for us, this is very simple in <code>R</code>. I call it the three step summary:</p>
<ol style="list-style-type: decimal">
<li>Data</li>
<li>Group by</li>
<li>Summarize</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Our Grouping Variable as a factor
dem_df$citizen &lt;-<span class="st"> </span><span class="kw">factor</span>(dem_df$dmdcitzn)

## Three step summary:
dem_df %&gt;%<span class="st">                           </span>## 1. Data
<span class="st">  </span><span class="kw">group_by</span>(citizen) %&gt;%<span class="st">              </span>## 2. Group by
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">N =</span> <span class="kw">n</span>())                 ## 3. Summarize</code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   citizen     N
##    &lt;fctr&gt; &lt;int&gt;
## 1       1  8685
## 2       2  1040
## 3       7    26
## 4      NA     5</code></pre>
<p>The output is very informative. The first column is the grouping variable and the second is the N (number of individuals) by group. We can quickly see that there are four levels, currently, to the citizen variable. After some reading of the documentation we see that <code>1 = Citizen</code> and <code>2 = Not a Citizen</code>. A value of <code>7</code> it turns out is a placeholder value for missing. And finally we have an NA category. It’s unlikely that we want those to be included in any analyses, unless we are particularly interested in the missingness on this variable. So let’s do some simple cleaning to get this where we want it. To do this, we will use the <code>furniture</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;furniture&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(furniture)

dem_df$citizen &lt;-<span class="st"> </span><span class="kw">washer</span>(dem_df$citizen, <span class="dv">7</span>)            ## Changes all 7&#39;s to NA&#39;s
dem_df$citizen &lt;-<span class="st"> </span><span class="kw">washer</span>(dem_df$citizen, <span class="dv">2</span>, <span class="dt">value=</span><span class="dv">0</span>)   ## Changes all 2&#39;s to 0&#39;s</code></pre></div>
<p>Now, our citizen variable is cleaned, with <code>0</code> meaning not a citizen and <code>1</code> meaning citizen. Let’s rerun the code from above with the three step summary:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Three step summary:
dem_df %&gt;%<span class="st">                           </span>## 1. Data
<span class="st">  </span><span class="kw">group_by</span>(citizen) %&gt;%<span class="st">              </span>## 2. Group by
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">N =</span> <span class="kw">n</span>())                 ## 3. Summarize</code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   citizen     N
##     &lt;chr&gt; &lt;int&gt;
## 1       0  1040
## 2       1  8685
## 3    &lt;NA&gt;    31</code></pre>
<p>Its clear that the majority of the subjects are citizens. We can also check multiple variables at the same time, just separating them with a comma in the <code>summarize</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Three step summary:
dem_df %&gt;%<span class="st">                           </span>## 1. Data
<span class="st">  </span><span class="kw">group_by</span>(citizen) %&gt;%<span class="st">              </span>## 2. Group by
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">N =</span> <span class="kw">n</span>(),                 ## 3. Summarize
            <span class="dt">Age =</span> <span class="kw">mean</span>(ridageyr, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))                 </code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   citizen     N      Age
##     &lt;chr&gt; &lt;int&gt;    &lt;dbl&gt;
## 1       0  1040 37.31635
## 2       1  8685 30.66252
## 3    &lt;NA&gt;    31 40.35484</code></pre>
<p>We used the <code>n()</code> function (which gives us counts) and the <code>mean()</code> function which, shockingly, gives us the mean. Note that if there are <code>NA</code>’s in the variable, the mean (and most other functions like it) will give the result <code>NA</code>. To have <code>R</code> ignore these, we tell the <code>mean</code> function to remove the <code>NA</code>’s when you compute this using <code>na.rm=TRUE</code>.</p>
<p>This pattern of grouping and summarizing is something that will follow us throughout the book. It’s a great way to get to know your data well and to make decisions on what to do next with your data.</p>
</div>
<div id="reshaping" class="section level2 unnumbered">
<h2>Reshaping</h2>
<p>This is a big part of working with data. Unfortunately, it is also a difficult topic to understand without much practice at it. In general, two data formats exist:</p>
<ol style="list-style-type: decimal">
<li>Wide form</li>
<li>Long form</li>
</ol>
<p>Only when the data is cross-sectional and each individual is a row does this distinction not matter much. Otherwise, if there are multiple measures per individual, or there are multiple individuals per cluster, the distinction between wide and long is very important for modeling and visualization.</p>
<div id="wide-form" class="section level3 unnumbered">
<h3>Wide Form</h3>
<p>Wide form generally has one unit (i.e. individual) per row. This generally looks like:</p>
<pre><code>##    ID  Var_Time1  Var_Time2
## 1   1  1.6563154 0.07860663
## 2   2 -1.4168542 0.47105008
## 3   3  1.5092959 0.37739092
## 4   4  0.6372972 0.18754105
## 5   5  2.6451100 0.16529842
## 6   6 -1.5990236 0.66680597
## 7   7  0.6392319 0.26290135
## 8   8 -0.5047252 0.81147928
## 9   9  0.6355322 0.77272733
## 10 10  0.7378649 0.89848352</code></pre>
<p>Notice that each row has a unique ID.</p>
<p>This format is common in the ANOVA family of analyses. These can be used when there are set time points that the individual is measured and each individual has the same number of time points. This is not always reasonable, but when it is, wide format works just fine. However, when these conditions don’t hold, mixed effects modeling (i.e. multilevel modeling, hierarchical linear modeling) is particularly useful. In order to do mixed effects modeling, long format is required.</p>
</div>
<div id="long-form" class="section level3 unnumbered">
<h3>Long Form</h3>
<p>In contrast, long format has the lowest nested unit as a single row. This means that a single ID can span multiple rows, usually with a unique time point for each row as so:</p>
<pre><code>##   ID Time        Var
## 1  1    1 0.60598965
## 2  1    2 0.32266714
## 3  1    3 0.18919008
## 4  1    4 0.86091539
## 5  2    1 0.20880816
## 6  2    2 0.11257798
## 7  3    1 0.72425568
## 8  3    2 0.07276276
## 9  3    3 0.07465099</code></pre>
<p>Notice that a single ID spans multiple columns and that each row has only one time point. Here, time is nested within individuals making it the lowest unit. Therefore, each row corresponds to a single time point. Generally, this is the format we want for most modeling techniques and most visualizations.</p>
</div>
</div>
<div id="joining-merging" class="section level2 unnumbered">
<h2>Joining (merging)</h2>
<p>The final topic in the chapter is joining data sets This is common when we are using bigger</p>
<p>We currently have 4 data sets that have mostly the same people in them but with different variables. One tells us about the demographics; another gives us information on mental health. We may have questions that ask whether a demographic characteristics is related to a mental health factor. This means we need to merge, or join, our data sets.<a href="#fn11" class="footnoteRef" id="fnref11"><sup>11</sup></a></p>
<p>When we merge a data set, we combine them based on some ID variable(s). Here, this is simple since each individual is given a unique identifier in the variable <code>seqn</code>. Within the <code>dplyr</code> package there are four main joining functions: <code>inner_join</code>, <code>left_join</code>, <code>right_join</code> and <code>full_join</code>. Each join combines the data in slightly different ways.</p>
<p>Let’s first load <code>dplyr</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)</code></pre></div>
<div id="inner-join" class="section level3 unnumbered">
<h3>Inner Join</h3>
<p>Here, only those individuals that are in both data sets that you are combining will remain. So if person “A” is in data set 1 and not in data set 2 then he/she will not be included.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">inner_join</span>(df1, df2, <span class="dt">by=</span><span class="st">&quot;IDvariable&quot;</span>)</code></pre></div>
</div>
<div id="left-or-right-join" class="section level3 unnumbered">
<h3>Left or Right Join</h3>
<p>This is similar to inner join but now if the individual is in data set 1 then <code>left_join</code> will keep them even if they aren’t in data set 2. <code>right_join</code> means if they are in data set 2 then they will be kept whether or not they are in data set 1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">left_join</span>(df1, df2, <span class="dt">by=</span><span class="st">&quot;IDvariable&quot;</span>)   ## keeps all in df1
<span class="kw">right_join</span>(df1, df2, <span class="dt">by=</span><span class="st">&quot;IDvariable&quot;</span>)  ## keeps all in df2</code></pre></div>
</div>
<div id="full-join" class="section level3 unnumbered">
<h3>Full Join</h3>
<p>This one simply keeps all individuals that are in either data set 1 or data set 2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">full_join</span>(df1, df2, <span class="dt">by=</span><span class="st">&quot;IDvariable&quot;</span>)</code></pre></div>
<p>Each of the left, right and full joins will have missing values placed in the variables where that individual wasn’t found. For example, if person “A” was not in df2, then in a full join they would have missing values in the df1 variables.</p>
<p>For our NHANES example, we will use <code>full_join</code> to get all the data sets together. Note that in the code below we do all the joining in the same overall step.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span>dem_df %&gt;%
<span class="st">  </span><span class="kw">full_join</span>(med_df, <span class="dt">by=</span><span class="st">&quot;seqn&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">full_join</span>(men_df, <span class="dt">by=</span><span class="st">&quot;seqn&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">full_join</span>(act_df, <span class="dt">by=</span><span class="st">&quot;seqn&quot;</span>)</code></pre></div>
<p>So now <code>df</code> is the the joined data set of all four. We started with <code>dem_df</code> joined it with <code>med_df</code> by <code>seqn</code> then joined that joined data set with <code>men_df</code> by <code>seqn</code>, and so on.</p>
<p>For analyses in the next chapter, we will use this new <code>df</code> object that is the combination of all the data sets that we had before.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="8">
<li id="fn8"><p>Hadley Wickham (2016). tidyverse: Easily Install and Load ‘Tidyverse’ Packages. R package version 1.0.0. <a href="https://CRAN.R-project.org/package=tidyverse" class="uri">https://CRAN.R-project.org/package=tidyverse</a><a href="chapter-2-manipulating-your-data.html#fnref8">↩</a></p></li>
<li id="fn9"><p>Remember, a package is an extension to <code>R</code> that gives you more functions that you can easily load into <code>R</code>.<a href="chapter-2-manipulating-your-data.html#fnref9">↩</a></p></li>
<li id="fn10"><p>Note that these are not particularly helpful names, but they are the names provided in the original data source. If you have questions about the data, visit <a href="http://wwwn.cdc.gov/Nchs/Nhanes/Search/Nhanes11_12.aspx" class="uri">http://wwwn.cdc.gov/Nchs/Nhanes/Search/Nhanes11_12.aspx</a>.<a href="chapter-2-manipulating-your-data.html#fnref10">↩</a></p></li>
<li id="fn11"><p>Note that this is different than adding new rows but not new variables. Merging requires that we have at least some overlap of individuals in both data sets.<a href="chapter-2-manipulating-your-data.html#fnref11">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-1-the-basics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-3-understanding-and-describing-your-data.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
